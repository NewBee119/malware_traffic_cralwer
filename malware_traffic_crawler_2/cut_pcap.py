#!/usr/bin/env python
# coding=utf-8

import os

def getPathFile(path,number=1):
    FinalPath = []
    child_path=path
    for i in range(0,number):
        FinalPath=getPathFile_one(child_path)
        child_path=FinalPath
    return FinalPath
  
def getPathFile_one(path):
    Path = []
    for first_path in path:
        #在最后一个目录之前的目录里跳过非文件夹文件
        try:
            pathDir = os.listdir(first_path)
            for allDir in pathDir:
                child = os.path.join('%s/%s' % (first_path, allDir))
                Path.append(child)
        except:
            pass
    return Path
    
def cut_pcap(pcap_path):
    all_pcapfile=getPathFile(pcap_path,1)
    count=1
    for pcap_file in all_pcapfile:
        currPcap_path=os.path.join(os.path.splitext(pcap_file)[0])
        #print currPcap_path
        if not os.path.exists(currPcap_path):
            os.makedirs(currPcap_path)
        restore_path=currPcap_path+'/'+os.path.basename(pcap_file)
        os.system('editcap -c 5000 %s %s' %(pcap_file,restore_path))
        print "editcap{0} : {1}".format(count, pcap_file)
        count+=1
        
        
pcap_files_path=['/home/test_LDG/malware-traffic-spider/task_spider']
cut_pcap(pcap_files_path)
